# Backend Development Dockerfile
FROM node:20-alpine

# Install build dependencies for native modules and Python packages
# Use ffmpeg-libs for full codec support including lavfi filters
RUN apk add --no-cache python3 py3-pip make g++ ffmpeg ffmpeg-libs

# Install edge-tts Python package for free TTS
RUN pip3 install --break-system-packages edge-tts

WORKDIR /app

# Copy package files first for better layer caching
COPY package.json package-lock.json* ./

# Install all dependencies (including devDependencies)
RUN npm install

# Copy source code (will be overridden by volume mounts in development)
COPY . .

# Expose the backend port
EXPOSE 3001

# Use tsx watch for hot reload development
# The --clear-screen=false prevents screen clearing issues in Docker logs
CMD ["npx", "tsx", "watch", "--clear-screen=false", "src/index.ts"]
